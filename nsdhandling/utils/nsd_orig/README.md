This code is imported from https://github.com/styvesg/nsd/tree/master/src
